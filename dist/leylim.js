!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Leylim=t()}(this,function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),n=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},i=[],r=function(){function n(){e(this,n)}return t(n,[{key:"subscribe",value:function(e){i.push(e)}},{key:"unsubscribe",value:function(e){i=i.filter(function(t){return t!==e})}},{key:"fire",value:function(e,t,n){var o=n||window;i.forEach(function(n){n.call(o,e,t)})}}],[{key:"handlers",get:function(){return i}}]),n}(),a="ADD_COMPONENT",c="DUPLICATE_ROW",d="DELETE_ROW",l=function(i){function c(t){e(this,c);var n=o(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));return n.component=t,n.render(),n}return n(c,r),t(c,[{key:"onclick",value:function(e){e.preventDefault(),this.fire(a,this.component,this)}},{key:"render",value:function(){var e=document.querySelector(".leylim__component-list"),t=document.createElement("a");t.href="#",t.onclick=this.onclick.bind(this),t.classList.add("leylim__list-item"),t.innerHTML='<img src="'+this.component.thumbnail+'" />',e.appendChild(t)}}]),c}(),s=function(){function n(t){e(this,n),this.options=t,this.listNode=null,this.init()}return t(n,[{key:"update",value:function(e){this.options.components=e,this.renderListItem()}},{key:"init",value:function(){var e=this.options.rootNode,t=document.querySelector(e),n=document.createElement("div");n.classList.add("leylim__component-list"),t.appendChild(n),this.listNode=n,this.renderListItem()}},{key:"renderListItem",value:function(){this.listNode.innerHTML="";for(var e=this.options.components,t=0;t<e.length;t++)new l(e[t])}}]),n}(),u=function(i){function a(t){e(this,a);var n=o(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return f.call(n),n.component=Object.assign({},t),n.rowNode=null,n.index=0,n.templateNode=null,n.actionsNode=null,n.rawHTMLmode=!1,n.actionButtons={ACTIONS_DUPLICATE:"leylim-actions actions--dupicate",ACTIONS_DELETE:"leylim-actions actions--delete",ACTIONS_HTML:"leylim-actions actions--edit",ACTIONS_ACTIVE:"action-active"},n}return n(a,r),t(a,[{key:"attachEvents",value:function(){var e=this,t=this.actionButtons,n=t.ACTIONS_DUPLICATE,o=t.ACTIONS_DELETE,i=t.ACTIONS_HTML,r=this.templateNode.querySelectorAll("[contenteditable]"),a=this.rowNode.querySelector("."+n.split(" ").join(".")),c=this.rowNode.querySelector("."+o.split(" ").join(".")),d=this.rowNode.querySelector("."+i.split(" ").join("."));r.forEach(function(t){t.onblur=e.onUpdateRowTemplate}),a.onclick=this.onDuplicate,c.onclick=this.onDelete,d.onclick=this.changeMode}},{key:"applyStyle",value:function(){var e=this.component,t=e.name,n=e.style,o="leylim-css-module-"+t;if(o=o.toLowerCase().trim().toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,""),!document.querySelector("#"+o)){var i=document.createElement("STYLE");i.setAttribute("id",o),i.innerHTML=n,document.head.appendChild(i)}}},{key:"render",value:function(e){var t=this.actionButtons,n=t.ACTIONS_DUPLICATE,o=t.ACTIONS_DELETE,i=t.ACTIONS_HTML,r=t.ACTIONS_ACTIVE;this.index=e;var a=document.querySelector(".leylim__area"),c=document.createElement("div");c.classList.add("leylim-area-row");var d=document.createElement("div");d.classList.add("leylim-area-row__template");var l=document.createElement("div");l.classList.add("leylim-area-row__actions"),l.innerHTML='\n      <a href="#" class="'+n+'">C</a>\n      <a href="#" class="'+o+'">D</a>\n      <a href="#" class="'+i+" "+(this.rawHTMLmode?r:"")+'">E</a>\n    ',this.rowNode=c,this.templateNode=d,this.actionsNode=l,c.appendChild(d),c.appendChild(l),a.appendChild(c),this.applyStyle(),this.renderContent(!0),this.attachEvents()}}],[{key:"useEvents",value:function(e){this.beforeRowUpdate=e.beforeRowUpdate,this.rowUpdated=e.rowUpdated}}]),a}(),f=function(){var e=this;this.onUpdateRowTemplate=function(){u.beforeRowUpdate(e.templateNode,e.component,function(t,n){var o=t.innerHTML;e.component=n,e.component.template=o}),u.rowUpdated(e.component,e.index)},this.renderContent=function(t){e.rawHTMLmode?(e.templateNode.innerText=e.component.template,e.templateNode.setAttribute("contenteditable",!0),e.templateNode.classList.add("leylim-html-mode")):(e.templateNode.innerHTML=e.templateNode.innerText||e.component.template,e.templateNode.setAttribute("contenteditable",!1),e.templateNode.classList.remove("leylim-html-mode"),t||e.onUpdateRowTemplate()),e.attachEvents()},this.changeMode=function(t){var n=e.actionButtons.ACTIONS_ACTIVE;t.preventDefault(),e.rawHTMLmode?t.target.classList.remove(n):t.target.classList.add(n),e.rawHTMLmode=!e.rawHTMLmode,e.renderContent()},this.onDuplicate=function(t){t.preventDefault();var n=Object.assign({},e.component),o=e.index;e.fire(c,{component:n,index:o})},this.onDelete=function(t){t.preventDefault();var n=Object.assign({},e.component),o=e.index;e.fire(d,{component:n,index:o})}},m=function(i){function l(t){e(this,l);var n=o(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));n.handleEvents=function(e,t){switch(e){case a:n.addComponent(t);break;case c:n.duplicateRow(t);break;case d:n.deleteRow(t)}},n.options=t,n.rowList=[];var i=n.options.events,r=i.beforeRowUpdate,s=i.rowUpdated;return u.useEvents({beforeRowUpdate:r,rowUpdated:s}),n.subscribe(n.handleEvents),n.generateRow(),n.initArea(),n.render(),n}return n(l,r),t(l,[{key:"getRowData",value:function(){for(var e=[],t=this.rowList,n=0;n<t.length;n++){var o=Object.assign({},t[n].component);e.push(JSON.stringify(o))}return e}},{key:"generateRow",value:function(){for(var e=this.options.rowList,t=0;t<e.length;t++)this.rowList.push(new u(e[t]))}},{key:"duplicateRow",value:function(e){var t=this,n=this.options.events,o=n.beforeRowDuplicate,i=n.rowDuplicated,r=void 0;o(e.component,function(n){r=n,t.rowList.splice(e.index+1,0,new u(n)),t.render()}),i(r)}},{key:"deleteRow",value:function(e){var t=this,n=this.options.events,o=n.beforeRowDelete,i=n.rowDeleted,r=void 0;o(e,function(e){r=e,t.rowList.splice(e.index,1),t.render()}),i(r)}},{key:"addComponent",value:function(e){var t=this,n=this.options.events,o=n.beforeRowAdd,i=n.rowAdded,r=void 0;o(e,function(e){r=e,t.rowList.push(new u(e)),t.render()}),i(r)}},{key:"initArea",value:function(){var e=this.options.rootNode,t=document.querySelector(e),n=document.createElement("div");n.classList.add("leylim__area"),t.appendChild(n),this.areaNode=n}},{key:"render",value:function(){for(var e=this.areaNode;e.firstChild;)e.removeChild(e.firstChild);if(this.rowList.length)for(var t=0;t<this.rowList.length;t++)this.rowList[t].render(t);else e.innerHTML='<div class="leylim__empty-area"><span>ðŸ˜’</span> </br> No content</div>'}}]),l}(),p=function(i){function a(t){e(this,a);var n=o(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return n.onShow=function(){n.fire()},n.options=t,n.init(),n}return n(a,r),t(a,[{key:"getButtons",value:function(e){var t=document.createElement("button");return t.classList.add("leylim__footer-button"),t.classList.add(e.class),t.setAttribute("type","button"),t.innerText=e.text,t.onclick=e.handler,t}},{key:"init",value:function(){var e=this.options,t=e.rootNode,n=e.buttons,o=document.querySelector(t),i=document.createElement("div");i.classList.add("leylim__footer");for(var r=0;r<n.length;r++){var a=this.getButtons(n[r]);i.appendChild(a)}o.appendChild(i)}}]),a}(),h=[{command:"bold",icon:"fa fa-bold"},{command:"italic",icon:"fa fa-italic"},{command:"createLink",icon:"fa fa-link",handler:function(){var e=window.prompt("Please insert a link","http://");document.execCommand("createLink",!0,e)}},{command:"unLink",icon:"fa fa-unlink"},{command:"cut",icon:"fa fa-cut"},{command:"delete",icon:"fa fa-trash-o",handler:function(e){document.execCommand("insertHTML",!0,"<p>"+e.toString()+"</p>")}},{command:"fontName",icon:"fa fa-font",value:"sans",handler:function(e){var t=window.prompt("Please insert font family","sans");document.execCommand("insertHTML",!0,'<span style="font-family: '+t+'">'+e+"</span>")}},{command:"foreColor",icon:"fa fa-paint-brush",value:"yellow",handler:function(e){var t=window.prompt("Please insert color","#000");document.execCommand("insertHTML",!0,'<span style="color: '+t+'">'+e+"</span>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:1,handler:function(e){document.execCommand("insertHTML",!0,"<h1>"+e+"</h1>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:2,handler:function(e){document.execCommand("insertHTML",!0,"<h2>"+e+"</h2>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:3,handler:function(e){document.execCommand("insertHTML",!0,"<h3>"+e+"</h3>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:4,handler:function(e){document.execCommand("insertHTML",!0,"<h4>"+e+"</h4>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:5,handler:function(e){document.execCommand("insertHTML",!0,"<h5>"+e+"</h5>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:6,handler:function(e){document.execCommand("insertHTML",!0,"<h6>"+e+"</h6>")}}],v=function(){function n(t){e(this,n),this.onClick=function(e,t){e.preventDefault(),t.handler?t.handler(window.getSelection()):document.execCommand(t.command,!0,t.value||2)},this.options=t,this.editorNode=null,this.buttons=h.concat(t.buttons),this.init(),this.catchSelection()}return t(n,[{key:"catchSelection",value:function(){document.onselectionchange=function(e){window.getSelection()}}},{key:"init",value:function(){var e=this,t=this.buttons,n=document.querySelector(".leylim"),o=document.createElement("div");this.editorNode=o,o.classList.add("leylim-editor");for(var i=0;i<t.length;i++)!function(n){var i=document.createElement("A");i.href="#",i.classList.add("leylim-editor__button"),i.innerHTML='<i class="'+t[n].icon+'"></i>'+(t[n].innerText||""),i.onclick=function(o){return e.onClick(o,t[n])},o.appendChild(i)}(i);n.appendChild(o)}}]),n}(),w={beforeCreate:function(e){return e},created:function(e){return e},beforeRowUpdate:function(e){return e},rowUpdated:function(e){return e},beforeRowDelete:function(e){return e},rowDeleted:function(e){return e},beforeRowDuplicate:function(e){return e},rowDuplicated:function(e){return e},beforeRowAdd:function(e){return e},rowAdded:function(e){return e}};return function(i){function a(t){e(this,a);var n=o(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));n.options=t;var i=n.options.beforeCreate;return(void 0===i?w.beforeCreate:i)(n.options),n.init(),n}return n(a,r),t(a,[{key:"update",value:function(e){var t=e.components;this.options.components=t,this._list.update(t)}},{key:"getRowData",value:function(){return this._area.getRowData()}},{key:"init",value:function(){var e=this.options,t=e.components,n=void 0===t?[]:t,o=e.el,i=e.rowList,r=void 0===i?[]:i,a=e.buttons,c=e.customEditorButtons,d=void 0===c?[]:c,l=e.created,u=void 0===l?w.created:l,f=e.beforeRowUpdate,h=void 0===f?w.beforeRowUpdate:f,y=e.rowUpdated,b=void 0===y?w.rowUpdated:y,L=e.beforeRowDelete,_=void 0===L?w.beforeRowDelete:L,T=e.rowDeleted,C=void 0===T?w.rowDeleted:T,k=e.beforeRowDuplicate,E=void 0===k?w.beforeRowDuplicate:k,N=e.rowDuplicated,D=void 0===N?w.rowDuplicated:N,g=e.beforeRowAdd,R=void 0===g?w.beforeRowAdd:g,A=e.rowAdded,O=void 0===A?w.rowAdded:A;if(!n.length)throw new Error("Can you give me components? please! If you don't have an idea; https://github.com/abdullah/leylim ");var S=document.querySelector(o),x=document.createElement("div");x.classList.add("leylim"),S.appendChild(x),this._list=new s({rootNode:".leylim",components:n}),this._footer=new p({rootNode:".leylim",buttons:a}),this._area=new m({rootNode:".leylim",rowList:r,events:{beforeRowUpdate:h,rowUpdated:b,beforeRowDelete:_,rowDeleted:C,beforeRowDuplicate:E,rowDuplicated:D,beforeRowAdd:R,rowAdded:O}}),this._editor=new v({buttons:d}),u()}}],[{key:"use",value:function(){}}]),a}()});
//# sourceMappingURL=leylim.js.map
