!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Leylim=t()}(this,function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),n=[],o=function(){function o(){e(this,o)}return t(o,null,[{key:"subscribe",value:function(e){n.push(e)}},{key:"unsubscribe",value:function(e){n=n.filter(function(t){return t!==e})}},{key:"fire",value:function(e,t,o){var i=o||window;n.forEach(function(n){n.call(i,e,t)})}},{key:"handlers",get:function(){return n}}]),o}(),i="ADD_COMPONENT",a="DUPLICATE_ROW",r="DELETE_ROW",d=function(){function n(t,o){e(this,n),this.thumbnailPath=o,this.component=t,this.render()}return t(n,[{key:"onclick",value:function(e){e.preventDefault(),o.fire(i,this.component,this)}},{key:"render",value:function(){var e=document.querySelector(".leylim__component-list"),t=document.createElement("a");t.href="#",t.onclick=this.onclick.bind(this),t.classList.add("leylim__list-item"),t.innerHTML='<img src="'+(this.thumbnailPath+this.component.thumbnail)+'" />',e.appendChild(t)}}]),n}(),s=function(){function n(t){e(this,n),this.options=t,this.listNode=null,this.init()}return t(n,[{key:"update",value:function(e){this.options.components=e,this.renderListItem()}},{key:"init",value:function(){var e=this.options.rootNode,t=document.querySelector(e),n=document.createElement("div");n.classList.add("leylim__component-list"),t.appendChild(n),this.listNode=n,this.renderListItem()}},{key:"renderListItem",value:function(){this.listNode.innerHTML="";for(var e=this.options,t=e.components,n=e.thumbnailPath,o=0;o<t.length;o++)new d(t[o],n)}}]),n}(),c=0,l=function(){function n(t){e(this,n),u.call(this),this.component=Object.assign({},t),this.rowNode=null,this.templateNode=null,this.actionsNode=null,this.rawHTMLmode=!1,this.actionButtons={ACTIONS_DUPLICATE:"actions--dupicate",ACTIONS_DELETE:"actions--delete",ACTIONS_HTML:"actions--edit",ACTIONS_ACTIVE:"action-active"},this._uuid=c++}return t(n,[{key:"toggleEditable",value:function(e){for(var t=this.templateNode.querySelectorAll("[contenteditable]"),n=0;n<t.length;n++)t[n].setAttribute("contenteditable",e)}},{key:"getRawData",value:function(){this.toggleEditable(!1);var e=this.templateNode.innerHTML;return this.toggleEditable(!0),e}},{key:"attachEvents",value:function(){var e=this,t=this.actionButtons,n=t.ACTIONS_DUPLICATE,o=t.ACTIONS_DELETE,i=t.ACTIONS_HTML,a=this.templateNode.querySelectorAll("[contenteditable]"),r=this.rowNode.querySelector("."+n),d=this.rowNode.querySelector("."+o),s=this.rowNode.querySelector("."+i);a.forEach(function(t){t.onblur=e.onUpdateRowTemplate}),r.onclick=this.onDuplicate,d.onclick=this.onDelete,s.onclick=this.changeMode}},{key:"applyStyle",value:function(){var e=this.component,t=e.name,n=e.style,o="leylim-css-module-"+t;if(o=o.toLowerCase().trim().toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,""),!document.querySelector("#"+o)){var i=document.createElement("STYLE");i.setAttribute("id",o),i.innerHTML=n,document.head.appendChild(i)}}},{key:"render",value:function(){var e=this.actionButtons,t=e.ACTIONS_DUPLICATE,n=e.ACTIONS_DELETE,o=e.ACTIONS_HTML,i=e.ACTIONS_ACTIVE,a=document.querySelector(".leylim__area"),r=document.createElement("div");r.classList.add("leylim-area-row");var d=document.createElement("div");d.classList.add("leylim-area-row__template");var s=document.createElement("div");s.classList.add("leylim-area-row__actions"),s.innerHTML='\n      <a href="#" class="leylim-actions '+t+'"><i class="fa fa-copy"></i></a>\n      <a href="#" class="leylim-actions '+n+'"><i class="fa fa-trash-o"></i></a>\n      <a href="#" class="leylim-actions '+o+" "+(this.rawHTMLmode?i:"")+'"><i class="fa fa-html5"></i></a>\n    ',this.rowNode=r,this.templateNode=d,this.actionsNode=s,r.appendChild(d),r.appendChild(s),a.appendChild(r),this.applyStyle(),this.renderContent(!0),this.attachEvents()}}],[{key:"useEvents",value:function(e){this.beforeRowUpdate=e.beforeRowUpdate,this.rowUpdated=e.rowUpdated}}]),n}(),u=function(){var e=this;this.onUpdateRowTemplate=function(){l.beforeRowUpdate(e.templateNode,e.component,function(t,n){var o=t.innerHTML;e.component=n,e.component.template=o}),l.rowUpdated(e.component,e._uuid)},this.renderContent=function(t){e.rawHTMLmode?(e.templateNode.innerText=e.component.template,e.templateNode.setAttribute("contenteditable",!0),e.templateNode.classList.add("leylim-html-mode")):(e.templateNode.innerHTML=e.templateNode.innerText||e.component.template,e.templateNode.setAttribute("contenteditable",!1),e.templateNode.classList.remove("leylim-html-mode"),t||e.onUpdateRowTemplate(),e.toggleEditable(!0)),e.attachEvents()},this.changeMode=function(t){t.preventDefault();var n=e.actionButtons,o=n.ACTIONS_ACTIVE,i=n.ACTIONS_HTML,a=e.actionsNode.querySelector("."+i);e.rawHTMLmode?a.classList.remove(o):a.classList.add(o),e.rawHTMLmode=!e.rawHTMLmode,e.renderContent()},this.onDuplicate=function(t){t.preventDefault(),o.fire(a,e._uuid)},this.onDelete=function(t){t.preventDefault(),o.fire(r,e._uuid)}},f=function(e,t){return e.indexOf(t)},m=function(){function n(t){var d=this;e(this,n),this.handleEvents=function(e,t){switch(e){case i:d.addComponent(t);break;case a:d.deleteAndDuplicateRow(t,!0);break;case r:d.deleteAndDuplicateRow(t,!1)}},this.options=t,this.rowList=[];var s=this.options.events,c=s.beforeRowUpdate,u=s.rowUpdated;l.useEvents({beforeRowUpdate:c,rowUpdated:u}),o.subscribe(this.handleEvents),this.generateRow(),this.initArea(),this.render()}return t(n,[{key:"getRowData",value:function(){for(var e=[],t=this.rowList,n=0;n<t.length;n++){var o=t[n].getRawData();e.push(JSON.stringify(o))}return e}},{key:"generateRow",value:function(){for(var e=this.options.rowList,t=0;t<e.length;t++)this.rowList.push(new l(e[t]))}},{key:"deleteAndDuplicateRow",value:function(e,t){var n=this,o=this.options.events,i=o.beforeRowDuplicate,a=o.rowDuplicated,r=o.beforeRowDelete,d=o.rowDeleted,s=void 0,c={},u=this.rowList.filter(function(t){return t._uuid==e})[0],m=f(this.rowList,u);c.component=Object.assign({},u.component),t?(i(c.component,function(e){s=e,n.rowList.splice(m+1,0,new l(e)),n.render()}),a(s)):(r(c,function(e){s=e,n.rowList.splice(m,1),n.render()}),d(s))}},{key:"addComponent",value:function(e){var t=this,n=this.options.events,o=n.beforeRowAdd,i=n.rowAdded,a=void 0;o(e,function(e){a=e,t.rowList.push(new l(e)),t.render()}),i(a)}},{key:"initArea",value:function(){var e=this.options.rootNode,t=document.querySelector(e),n=document.createElement("div");n.classList.add("leylim__area"),t.appendChild(n),this.areaNode=n}},{key:"render",value:function(){for(var e=this.areaNode;e.firstChild;)e.removeChild(e.firstChild);if(this.rowList.length)for(var t=0;t<this.rowList.length;t++)this.rowList[t].render(t);else e.innerHTML='<div class="leylim__empty-area"><span>ðŸ˜’</span> </br> No content</div>'}}]),n}(),h=function(){function n(t){e(this,n),this.options=t,this.init()}return t(n,[{key:"getButtons",value:function(e){var t=document.createElement("button");return t.classList.add("leylim__footer-button"),t.classList.add(e.class),t.setAttribute("type","button"),t.innerText=e.text,t.onclick=e.handler,t}},{key:"init",value:function(){var e=this.options,t=e.rootNode,n=e.buttons,o=document.querySelector(t),i=document.createElement("div");i.classList.add("leylim__footer");for(var a=0;a<n.length;a++){var r=this.getButtons(n[a]);i.appendChild(r)}o.appendChild(i)}}]),n}(),p=[{command:"bold",icon:"fa fa-bold"},{command:"italic",icon:"fa fa-italic"},{command:"createLink",icon:"fa fa-link",handler:function(){var e=window.prompt("Please insert a link","http://");document.execCommand("createLink",!0,e)}},{command:"unLink",icon:"fa fa-unlink"},{command:"cut",icon:"fa fa-cut"},{command:"delete",icon:"fa fa-trash-o",handler:function(e){document.execCommand("insertHTML",!0,"<p>"+e.toString()+"</p>")}},{command:"fontName",icon:"fa fa-font",value:"sans",handler:function(e){var t=window.prompt("Please insert font family","sans");document.execCommand("insertHTML",!0,'<span style="font-family: '+t+'">'+e+"</span>")}},{command:"foreColor",icon:"fa fa-paint-brush",value:"yellow",handler:function(e){var t=window.prompt("Please insert color","#000");document.execCommand("insertHTML",!0,'<span style="color: '+t+'">'+e+"</span>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:1,handler:function(e){document.execCommand("insertHTML",!0,"<h1>"+e+"</h1>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:2,handler:function(e){document.execCommand("insertHTML",!0,"<h2>"+e+"</h2>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:3,handler:function(e){document.execCommand("insertHTML",!0,"<h3>"+e+"</h3>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:4,handler:function(e){document.execCommand("insertHTML",!0,"<h4>"+e+"</h4>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:5,handler:function(e){document.execCommand("insertHTML",!0,"<h5>"+e+"</h5>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:6,handler:function(e){document.execCommand("insertHTML",!0,"<h6>"+e+"</h6>")}}],v=function(){function n(t){e(this,n),this.onClick=function(e,t){e.preventDefault(),t.handler?t.handler(window.getSelection()):document.execCommand(t.command,!0,t.value||2)},this.options=t,this.editorNode=null;var o=t.filter?t.filter(p):p;t.merge?this.buttons=o.concat(t.buttons):this.buttons=t.buttons,this.init()}return t(n,[{key:"init",value:function(){var e=this,t=this.buttons,n=document.querySelector(".leylim"),o=document.createElement("div");this.editorNode=o,o.classList.add("leylim-editor");for(var i=0;i<t.length;i++)!function(n){var i=document.createElement("A");i.href="#",i.classList.add("leylim-editor__button"),i.innerHTML='<i class="'+t[n].icon+'"></i>'+(t[n].innerText||""),i.onclick=function(o){return e.onClick(o,t[n])},o.appendChild(i)}(i);n.appendChild(o)}}]),n}(),w={beforeCreate:function(){},created:function(){},beforeRowUpdate:function(e,t,n){n(t,t)},rowUpdated:function(){},beforeRowDelete:function(e,t){t(e)},rowDeleted:function(){},beforeRowDuplicate:function(e,t){t(e)},rowDuplicated:function(){},beforeRowAdd:function(e,t){t(e)},rowAdded:function(){}};return function(){function n(t){e(this,n),this.options=t;var o=this.options.beforeCreate;(void 0===o?w.beforeCreate:o)(this.options),this.init()}return t(n,[{key:"update",value:function(e){var t=e.components;this.options.components=t,this._list.update(t)}},{key:"getRowData",value:function(){return this._area.getRowData()}},{key:"init",value:function(){var e=this.options,t=e.components,n=void 0===t?[]:t,o=e.el,i=e.rowList,a=void 0===i?[]:i,r=e.buttons,d=void 0===r?[]:r,c=e.thumbnailPath,l=void 0===c?"":c,u=e.customEditorButtons,f=void 0===u?{merge:!0,buttons:[]}:u,p=e.created,y=void 0===p?w.created:p,b=e.beforeRowUpdate,L=void 0===b?w.beforeRowUpdate:b,T=e.rowUpdated,C=void 0===T?w.rowUpdated:T,k=e.beforeRowDelete,N=void 0===k?w.beforeRowDelete:k,E=e.rowDeleted,_=void 0===E?w.rowDeleted:E,D=e.beforeRowDuplicate,g=void 0===D?w.beforeRowDuplicate:D,A=e.rowDuplicated,R=void 0===A?w.rowDuplicated:A,S=e.beforeRowAdd,M=void 0===S?w.beforeRowAdd:S,H=e.rowAdded,x=void 0===H?w.rowAdded:H;if(!n.length)throw new Error("Can you give me components? please! If you don't have an idea; https://github.com/abdullah/leylim ");var U=document.querySelector(o),I=document.createElement("div");I.classList.add("leylim"),U.appendChild(I),this._list=new s({rootNode:".leylim",thumbnailPath:l,components:n}),this._footer=new h({rootNode:".leylim",buttons:d}),this._area=new m({rootNode:".leylim",rowList:a,events:{beforeRowUpdate:L,rowUpdated:C,beforeRowDelete:N,rowDeleted:_,beforeRowDuplicate:g,rowDuplicated:R,beforeRowAdd:M,rowAdded:x}}),this._editor=new v({merge:f.merge,buttons:f.buttons,filter:f.filter}),y()}}],[{key:"use",value:function(){}}]),n}()});
//# sourceMappingURL=leylim.js.map
