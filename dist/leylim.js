!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Leylim=t()}(this,function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),n=[],o=function(){function o(){e(this,o)}return t(o,null,[{key:"subscribe",value:function(e){n.push(e)}},{key:"unsubscribe",value:function(e){n=n.filter(function(t){return t!==e})}},{key:"fire",value:function(e,t,o){var i=o||window;n.forEach(function(n){n.call(i,e,t)})}},{key:"handlers",get:function(){return n}}]),o}(),i="leylim-html-mode",a={LEYLIM_ROOT:"leylim",LIST_ITEM_CONTAINER_NODE:"leylim__component-list",LIST_ITEM_NODE:"leylim__list-item",AREA_NODE:"leylim__area",AREA_ROW_NODE:"leylim-area-row",AREA_ROW_ACTIONS_NODE:"leylim-area-row__actions",AREA_ROW_TEMPLATE_NODE:"leylim-area-row__template",FOOTER_NODE:"leylim__footer",HTML_MODE_NODE:i},r="ADD_COMPONENT",l="DUPLICATE_ROW",c="DELETE_ROW",s=function(){function n(t,o){e(this,n),this.thumbnailPath=o,this.component=t,this.render()}return t(n,[{key:"onclick",value:function(e){e.preventDefault(),o.fire(r,this.component,this)}},{key:"render",value:function(){var e=document.querySelector(".leylim__component-list"),t=document.createElement("a");t.href="#",t.onclick=this.onclick.bind(this),t.classList.add("leylim__list-item"),t.innerHTML='<img src="'+(this.thumbnailPath+this.component.thumbnail)+'" />',e.appendChild(t)}}]),n}(),d=function(){function n(t){e(this,n),this.options=t,this.listNode=null,this.init()}return t(n,[{key:"update",value:function(e){this.options.components=e,this.renderListItem()}},{key:"init",value:function(){var e=this.options.rootNode,t=document.querySelector(e),n=document.createElement("div");n.classList.add("leylim__component-list"),t.appendChild(n),this.listNode=n,this.renderListItem()}},{key:"renderListItem",value:function(){this.listNode.innerHTML="";for(var e=this.options,t=e.components,n=e.thumbnailPath,o=0;o<t.length;o++)new s(t[o],n)}}]),n}(),u=void 0,m={beforeCreate:function(e){return e},created:function(e){return e},beforeRowUpdate:function(e){return e},rowUpdated:function(e){return e},beforeRowDelete:function(e){return e},rowDeleted:function(e){return e},beforeRowDuplicate:function(e){return e},rowDuplicated:function(e){return e},beforeRowAdd:function(e){return e},rowAdded:function(e){return e}},h=function(e){return u=e},f=function(e,t){return u[e](t)},p=0,v=function(){function n(t){var a=this;e(this,n),this.onUpdateRowTemplate=function(){var e=f("beforeRowUpdate",{node:a.templateNode,component:a.component}),t=e.node.innerHTML;a.component=e.component,a.component.template=t,a.component.onUpdate&&a.component.onUpdate(a.templateNode,a.component),f("rowUpdated",{component:a.component,_uuid:a._uuid})},this.renderContent=function(e){a.rawHTMLmode?(a.templateNode.innerText=a.component.template,a.templateNode.setAttribute("contenteditable",!0),a.templateNode.classList.add(i)):(a.templateNode.innerHTML=a.templateNode.innerText||a.component.template,a.templateNode.setAttribute("contenteditable",!1),a.templateNode.classList.remove(i),e||a.onUpdateRowTemplate(),a.toggleEditable(!0)),a.attachEvents()},this.changeMode=function(e){e.preventDefault();var t=a.actionButtons,n=t.ACTIONS_ACTIVE,o=t.ACTIONS_HTML,i=a.actionsNode.querySelector("."+o);a.rawHTMLmode?i.classList.remove(n):i.classList.add(n),a.rawHTMLmode=!a.rawHTMLmode,a.renderContent()},this.onDuplicate=function(e){e.preventDefault(),o.fire(l,a._uuid)},this.onDelete=function(e){e.preventDefault(),o.fire(c,a._uuid)},this.component=Object.assign({},t),this.rowNode=null,this.templateNode=null,this.actionsNode=null,this.rawHTMLmode=!1,this.actionButtons={ACTIONS_DUPLICATE:"actions--dupicate",ACTIONS_DELETE:"actions--delete",ACTIONS_HTML:"actions--edit",ACTIONS_ACTIVE:"action-active"},this._uuid=p++,o.subscribe(this.onUpdateRowTemplate)}return t(n,[{key:"toggleEditable",value:function(e){for(var t=this.templateNode.querySelectorAll("[contenteditable]"),n=0;n<t.length;n++)t[n].setAttribute("contenteditable",e)}},{key:"getRawData",value:function(){this.toggleEditable(!1);var e=Object.assign({},this.component);return e.template=this.templateNode.innerHTML,this.toggleEditable(!0),e}},{key:"attachEvents",value:function(){var e=this,t=this.actionButtons,n=t.ACTIONS_DUPLICATE,o=t.ACTIONS_DELETE,i=t.ACTIONS_HTML,a=this.templateNode.querySelectorAll("[contenteditable]"),r=this.rowNode.querySelector("."+n),l=this.rowNode.querySelector("."+o),c=this.rowNode.querySelector("."+i);a.forEach(function(t){t.onblur=e.onUpdateRowTemplate}),r.onclick=this.onDuplicate,l.onclick=this.onDelete,c.onclick=this.changeMode}},{key:"applyStyle",value:function(){var e=this.component,t=e.name,n=e.style,o="leylim-css-module-"+t;if(o=o.toLowerCase().trim().toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,""),!document.querySelector("#"+o)){var i=document.createElement("STYLE");i.setAttribute("id",o),i.innerHTML=n,document.head.appendChild(i)}}},{key:"render",value:function(){var e=this.actionButtons,t=e.ACTIONS_DUPLICATE,n=e.ACTIONS_DELETE,o=e.ACTIONS_HTML,i=e.ACTIONS_ACTIVE,a=document.querySelector(".leylim__area"),r=document.createElement("div");r.classList.add("leylim-area-row"),this.rendered||(this.rendered=!0,r.classList.add("added"));var l=document.createElement("div");l.classList.add("leylim-area-row__template");var c=document.createElement("div");c.classList.add("leylim-area-row__actions"),c.innerHTML='\n      <a href="#" class="leylim-actions '+t+'"><i class="fa fa-copy"></i></a>\n      <a href="#" class="leylim-actions '+n+'"><i class="fa fa-trash-o"></i></a>\n      <a href="#" class="leylim-actions '+o+" "+(this.rawHTMLmode?i:"")+'"><i class="fa fa-html5"></i></a>\n    ',this.rowNode=r,this.templateNode=l,this.actionsNode=c,r.appendChild(l),r.appendChild(c),a.appendChild(r),this.applyStyle(),this.renderContent(!0),this.attachEvents()}}]),n}(),w=function(e,t){return e.indexOf(t)},y=function(){function n(t){var i=this;e(this,n),this.handleEvents=function(e,t){switch(i.saveScroll(),e){case r:i.addComponent(t);break;case l:i.deleteAndDuplicateRow(t,!0);break;case c:i.deleteAndDuplicateRow(t,!1)}i.restoreScroll()},this.options=t,this.rowList=[],o.subscribe(this.handleEvents),this.generateRow(),this.initArea(),this.render()}return t(n,[{key:"getRowData",value:function(){for(var e=[],t=this.rowList,n=0;n<t.length;n++){var o=t[n].getRawData();e.push(JSON.stringify(o))}return e}},{key:"generateRow",value:function(){for(var e=this.options.rowList,t=0;t<e.length;t++)this.rowList.push(new v(e[t]))}},{key:"saveScroll",value:function(){this.scrollPosition={x:window.scrollX,y:window.scrollY}}},{key:"restoreScroll",value:function(){var e=this.scrollPosition,t=e.x,n=e.y;window.scroll(t,n)}},{key:"deleteAndDuplicateRow",value:function(e,t){var n={},o=this.rowList.filter(function(t){return t._uuid==e})[0],i=w(this.rowList,o);if(n.component=Object.assign({},o.component),t){var a=f("beforeRowDuplicate",n.component);this.rowList.splice(i+1,0,new v(a)),this.render(),f("rowDuplicated",n.component)}else{var r=f("beforeRowDelete",n);this.rowList.splice(i,1),this.render(),f("rowDeleted",r)}}},{key:"addComponent",value:function(e){var t=f("beforeRowAdd",e);this.rowList.push(new v(t)),this.render(),f("rowAdded")}},{key:"initArea",value:function(){var e=this.options.rootNode,t=document.querySelector(e),n=document.createElement("div");n.classList.add("leylim__area"),t.appendChild(n),this.areaNode=n}},{key:"render",value:function(){for(var e=this.areaNode;e.firstChild;)e.removeChild(e.firstChild);if(this.rowList.length)for(var t=0;t<this.rowList.length;t++)this.rowList[t].render();else e.innerHTML='<div class="leylim__empty-area added"><span>ðŸ˜’</span> </br> No content</div>'}}]),n}(),L=function(){function n(t){e(this,n),this.options=t,this.init()}return t(n,[{key:"getButtons",value:function(e){var t=document.createElement("button");return t.classList.add("leylim__footer-button"),t.classList.add(e.btnClass),t.setAttribute("type","button"),t.innerText=e.text,t.onclick=e.handler,t}},{key:"init",value:function(){var e=this.options,t=e.rootNode,n=e.buttons,o=document.querySelector(t),i=document.createElement("div");i.classList.add("leylim__footer");for(var a=0;a<n.length;a++){var r=this.getButtons(n[a]);i.appendChild(r)}o.appendChild(i)}}]),n}(),_=function(){function n(t){e(this,n),this.onClick=function(e,t){e.preventDefault(),t.handler?t.handler(window.getSelection(),E):document.execCommand(t.command,!0,t.value||2)},this.options=t,this.editorNode=null;var o=E.editorButtons,i=t.filter?t.filter(o):o;t.merge?this.buttons=i.concat(t.buttons):this.buttons=t.buttons,this.init()}return t(n,[{key:"init",value:function(){var e=this,t=this.buttons,n=document.querySelector(".leylim"),o=document.createElement("div");this.editorNode=o,o.classList.add("leylim-editor");for(var i=0;i<t.length;i++)!function(n){var i=document.createElement("A");i.href="#",i.classList.add("leylim-editor__button"),i.innerHTML='<i class="'+t[n].icon+'"></i>'+(t[n].innerText||""),i.onclick=function(o){return e.onClick(o,t[n])},o.appendChild(i)}(i);n.appendChild(o)}}]),n}(),T=[{command:"bold",icon:"fa fa-bold"},{command:"italic",icon:"fa fa-italic"},{command:"createLink",icon:"fa fa-link",handler:function(){var e=window.prompt("Please insert a link","http://");document.execCommand("createLink",!0,e)}},{command:"unLink",icon:"fa fa-unlink"},{command:"cut",icon:"fa fa-cut"},{command:"delete",icon:"fa fa-trash-o",handler:function(e){document.execCommand("insertHTML",!0,"<p>"+e.toString()+"</p>")}},{command:"fontName",icon:"fa fa-font",value:"sans",handler:function(e){var t=window.prompt("Please insert font family","sans");document.execCommand("insertHTML",!0,'<span style="font-family: '+t+'">'+e+"</span>")}},{command:"foreColor",icon:"fa fa-paint-brush",value:"yellow",handler:function(e,t){t.$getModal({}).open(),document.execCommand("insertHTML",!0,"<span style=\"color: window.prompt('Please insert color', '#000')\">"+e+"</span>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:1,handler:function(e){document.execCommand("insertHTML",!0,"<h1>"+e+"</h1>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:2,handler:function(e){document.execCommand("insertHTML",!0,"<h2>"+e+"</h2>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:3,handler:function(e){document.execCommand("insertHTML",!0,"<h3>"+e+"</h3>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:4,handler:function(e){document.execCommand("insertHTML",!0,"<h4>"+e+"</h4>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:5,handler:function(e){document.execCommand("insertHTML",!0,"<h5>"+e+"</h5>")}},{command:"formatBlock",icon:"fa fa-header fa-1",innerText:6,handler:function(e){document.execCommand("insertHTML",!0,"<h6>"+e+"</h6>")}}],b=null,E=function(){function n(t){e(this,n),this.options=t;var o=Object.assign({},m,this.options);h(o),f("beforeCreate"),this.init()}return t(n,[{key:"update",value:function(e){var t=e.components;this.options.components=t,this._list.update(t)}},{key:"getRowData",value:function(){return this._area.getRowData()}},{key:"init",value:function(){var e=this.options,t=e.components,o=void 0===t?[]:t,i=e.el,a=e.rowList,r=void 0===a?[]:a,l=e.buttons,c=void 0===l?[]:l,s=e.thumbnailPath,u=void 0===s?"":s,m=e.customEditorButtons,h=void 0===m?{merge:!0,buttons:[]}:m;if(!o.length)throw new Error("Can you give me components? please! If you don't have an idea; https://github.com/abdullah/leylim ");var p=document.querySelector(i),v=document.createElement("div");v.classList.add("leylim"),p.appendChild(v),this._list=new d({rootNode:".leylim",thumbnailPath:u,components:o}),this._footer=new L({rootNode:".leylim",buttons:c}),this._area=new y({rootNode:".leylim",rowList:r}),n._plugins.forEach(function(e){e()}),this._editor=new _({merge:h.merge,buttons:h.buttons,filter:h.filter}),f("created")}}],[{key:"use",value:function(e,t){var n=this;this._plugins.push(function(){e.install(n,t)})}},{key:"forceUpdate",value:function(){o.fire("forceUpdate")}}]),n}();return E.saveSelection=function(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount)return b=e.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return b=document.selection.createRange();return null},E.restoreSelection=function(){if(b)if(window.getSelection){var e=window.getSelection();e.removeAllRanges(),e.addRange(b)}else document.selection&&b.select&&b.select()},E.editorButtons=T,E.nodes=a,E._plugins=[],E});
//# sourceMappingURL=leylim.js.map
